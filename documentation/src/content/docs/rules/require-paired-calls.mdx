---
title: require-paired-calls
---

import { Code } from "@astrojs/starlight/components";

Enforces that paired function calls (opener/closer) are properly balanced across all execution paths with LIFO (Last In, First Out) ordering.

## Rule Details

This rule ensures resource management patterns like profiling markers, database transactions, and locks are properly paired. It validates that:

1. Every opener has a matching closer
2. Closers are called in LIFO order (like stack unwinding)
3. All code paths include the closer (no early returns without cleanup)
4. Optional sync requirements prevent async operations between pairs

## Options

<Code
	code={[
		"{",
		'\t"cease-nonsense/require-paired-calls": [',
		'\t\t"error",',
		"\t\t{",
		'\t\t\t"pairs": [',
		"\t\t\t\t{",
		'\t\t\t\t\t"opener": "debug.profilebegin",',
		'\t\t\t\t\t"closer": "debug.profileend",',
		'\t\t\t\t\t"alternatives": ["db.rollback"],',
		'\t\t\t\t\t"requireSync": true,',
		'\t\t\t\t\t"platform": "roblox",',
		'\t\t\t\t\t"yieldingFunctions": ["task.wait", "*.WaitForChild"],',
		"\t\t\t\t},",
		"\t\t\t],",
		'\t\t\t"allowConditionalClosers": false,',
		'\t\t\t"allowMultipleOpeners": true,',
		'\t\t\t"maxNestingDepth": 0,',
		"\t\t},",
		"\t],",
		"}",
	].join("\n")}
	lang="typescript"
	key="block-0-f3izkr"
/>

### Pair Configuration

- **opener** (required): Function name that starts the paired operation
- **openerAlternatives** (optional): Additional opener names sharing the same closer
- **closer** (required): Function name(s) that close the operation (string or array)
- **alternatives** (optional): Alternative closers for error paths (e.g., rollback)
- **requireSync** (optional): Disallow `await`/`yield` between opener and closer
- **platform** (optional): Platform-specific behavior (`"roblox"`)
- **yieldingFunctions** (optional): Patterns for Roblox yielding functions (supports wildcards like `*.WaitForChild`)

### Top-Level Options

- **pairs** (required): Array of pair configurations
- **allowConditionalClosers** (optional): Allow closers in some but not all branches
- **allowMultipleOpeners** (optional): Allow consecutive opener calls without closers
- **maxNestingDepth** (optional): Maximum nesting depth (0 = unlimited)

## Examples

### ❌ Incorrect

<Code
	code={[
		"// Missing closer on early return",
		"function test() {",
		'\tdebug.profilebegin("task");',
		"\tif (error) return; // Never closed!",
		"\tdebug.profileend();",
		"}",
		"",
		"// Wrong LIFO order",
		"function test() {",
		'\tdebug.profilebegin("outer");',
		'\tdebug.profilebegin("inner");',
		"\tdebug.profileend(); // closes inner",
		"\t// outer is never closed",
		"}",
		"",
		"// Async operation with requireSync",
		"async function test() {",
		'\tdebug.profilebegin("task");',
		'\tawait fetch("/api"); // Violates requireSync',
		"\tdebug.profileend();",
		"}",
		"",
		"// Closer in only one branch",
		"function test() {",
		'\tdebug.profilebegin("task");',
		"\tif (condition) {",
		"\t\tdebug.profileend();",
		"\t}",
		"\t// Missing closer on else branch",
		"}",
		"",
		"// Roblox: yielding call between pairs",
		"function test() {",
		'\tdebug.profilebegin("task");',
		"\ttask.wait(1); // Yields, breaks sync requirement",
		"\tdebug.profileend();",
		"}",
	].join("\n")}
	lang="typescript"
	key="missing-closer-on-ea-1xaz48"
/>

### ✅ Correct

<Code
	code={[
		"// Simple pairing",
		"function test() {",
		'\tdebug.profilebegin("task");',
		"\tdoWork();",
		"\tdebug.profileend();",
		"}",
		"",
		"// Proper LIFO nesting",
		"function test() {",
		'\tdebug.profilebegin("outer");',
		'\tdebug.profilebegin("inner");',
		"\tdebug.profileend(); // closes inner",
		"\tdebug.profileend(); // closes outer",
		"}",
		"",
		"// Try-finally ensures closer on all paths",
		"function test() {",
		'\tdebug.profilebegin("task");',
		"\ttry {",
		"\t\triskyOperation();",
		"\t} finally {",
		"\t\tdebug.profileend();",
		"\t}",
		"}",
		"",
		"// Alternative closer for error path",
		"async function test() {",
		"\tawait db.transaction();",
		"\ttry {",
		'\t\tawait db.query("INSERT ...");',
		"\t\tawait db.commit();",
		"\t} catch {",
		"\t\tawait db.rollback(); // Alternative closer",
		"\t}",
		"}",
		"",
		"// Multiple openers with allowMultipleOpeners",
		"function test() {",
		'\tdebug.profilebegin("task1");',
		'\tdebug.profilebegin("task2");',
		"\tdebug.profileend();",
		"\tdebug.profileend();",
		"}",
	].join("\n")}
	lang="typescript"
	key="simple-pairing-1jji1e"
/>

## Real-World Examples

### Database Transactions

<Code
	code={[
		"{",
		'  "pairs": [{',
		'    "opener": "db.transaction",',
		'    "closer": "db.commit",',
		'    "alternatives": ["db.rollback"]',
		"  }]",
		"}",
	].join("\n")}
	lang="typescript"
	key="block-3-31akcy"
/>

<Code
	code={[
		"async function updateUser(id: number, data: UserData) {",
		"\tawait db.transaction();",
		"\ttry {",
		'\t\tawait db.query("UPDATE users SET ...", data);',
		"\t\tawait db.commit();",
		"\t} catch (error) {",
		"\t\tawait db.rollback();",
		"\t\tthrow error;",
		"\t}",
		"}",
	].join("\n")}
	lang="typescript"
	key="async-function-updat-2w6jds"
/>

### Lock Acquire/Release

<Code
	code={[
		"{",
		'  "pairs": [{',
		'    "opener": "lock.acquire",',
		'    "closer": ["lock.release", "lock.free"]',
		"  }]",
		"}",
	].join("\n")}
	lang="typescript"
	key="block-5-121dxd"
/>

<Code
	code={[
		"async function criticalSection() {",
		"\tawait lock.acquire();",
		"\ttry {",
		"\t\tawait modifySharedResource();",
		"\t} finally {",
		"\t\tlock.release();",
		"\t}",
		"}",
	].join("\n")}
	lang="typescript"
	key="async-function-criti-owcvcz"
/>

### Roblox Iris UI

<Code
	code={[
		"{",
		'  "pairs": [{',
		'    "opener": "Iris.CollapsingHeader",',
		'    "openerAlternatives": ["Iris.Window", "Iris.TreeNode", "Iris.Table"],',
		'    "closer": "Iris.End",',
		'    "platform": "roblox",',
		'    "requireSync": true',
		"  }]",
		"}",
	].join("\n")}
	lang="typescript"
	key="block-7-2foexk"
/>

<Code
	code={[
		"function renderUI() {",
		'\tif (Iris.CollapsingHeader("Section")) {',
		'\t\tIris.Text("Content");',
		"\t\tIris.End();",
		"\t}",
		"}",
	].join("\n")}
	lang="typescript"
	key="function-renderui-1c9gx7"
/>

## Platform-Specific Behavior

### Roblox Platform

When `platform: "roblox"` is set, the rule detects yielding functions that break synchronous execution:

- Built-in: `task.wait`, `wait`
- Patterns: `*.WaitForChild`, `*.WaitFor*`
- Custom patterns via `yieldingFunctions` option

<Code
	code={[
		"// Violates Roblox sync requirement",
		"function badCode() {",
		'\tdebug.profilebegin("task");',
		'\tconst part = workspace.WaitForChild("Part"); // Yields!',
		"\tdebug.profileend();",
		"}",
		"",
		"// Correct: no yielding",
		"function goodCode() {",
		'\tdebug.profilebegin("task");',
		'\tconst part = workspace.FindFirstChild("Part");',
		"\tdebug.profileend();",
		"}",
	].join("\n")}
	lang="typescript"
	key="violates-roblox-sync-kh47v2"
/>

## When Not To Use It

If your codebase doesn't use paired resource management patterns, this rule isn't applicable. Disable it or configure specific pairs for your use case.

## Related Rules

- [react-hooks-strict-return](/rules/react-hooks-strict-return/) - Enforces hook return value patterns

## Further Reading

- [Resource Acquisition Is Initialization (RAII)](https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)
- [Roblox Profiling Best Practices](https://create.roblox.com/docs/scripting/performance-optimization/profiling)
